{% extends "base.html" %}
{% block title %}Two Week Preview{% endblock %}
{% block content %}

<h2 class="text-center mb-4">Two Week Preview</h2>

<div class="text-center mb-3">
  <label for="majorGroupFilter">Filter by Major Group:</label>
  <select id="majorGroupFilter" class="form-select d-inline-block w-auto" onchange="onFilterChange()">
    <option value="">All</option>
    <option value="CivilandConstruction" {% if major_group == 'CivilandConstruction' %}selected{% endif %}>Civil and Construction</option>
    <option value="Mathematics" {% if major_group == 'Mathematics' %}selected{% endif %}>Mathematics</option>
    <!-- Add more options as needed and change dictionary below-->
  </select>
</div>

{% set display_names = {
  "CivilandConstruction": "Civil and Construction",
  "Mathematics": "Mathematics"
} %}

<script>
  function onFilterChange() {
    const filter = document.getElementById('majorGroupFilter').value;
    const url = new URL(window.location);
    if (filter) {
      url.searchParams.set('major_group', filter);
    } else {
      url.searchParams.delete('major_group');
    }
    window.location = url.toString();
  }
</script>

<style>
  .week-box {
      max-width: 1000px;
      margin: 1.5rem auto;
      padding: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: #fefefe;
    }
    .week-box h3 {
      margin-top: 0;
      border-bottom: 1px solid #ddd;
      padding-bottom: 0.5rem;
    }
    .event-row {
    display: grid;
    grid-template-columns: 1fr 1.5fr 3fr 2fr 2fr; /* last column uses 2fr too */
    /* 
    Columns:
    - Weekday/Date: 1fr (smaller)
    - Type: 1.5fr
    - Company: 3fr
    - Time: 2fr
    - Location: 2fr
    */
    gap: 10px;
    padding: 6px 0;
    border-bottom: 1px solid #eee;
    align-items: center;
    white-space: nowrap; /* prevent wrapping */
  }
  .event-row:last-child {
    border-bottom: none;
  }
  .event-cell {
    overflow: visible;
    text-overflow: clip;
    white-space: nowrap; /* prevents wrapping */
  }
  .event-cell.date {
    flex: 1.2;
  }
  .event-cell.company {
    flex: 2;
  }
</style>

<h2 class="text-center mb-3">
  {{ display_names.get(major_group, "All") }} Events
</h2>

<div class="week-box">
  <h3>This Week</h3>
  {% for event in events %}
    {% set event_date = event.EventDate | todatetime %}
    {% if event_date >= days[0] and event_date <= days[4] %}
      <div class="event-row">
        <div class="event-cell date">{{ event_date.strftime('%a, %b %d') }}</div>
        <div class="event-cell">
          {% set company_name = event.Company or event.EmployerName or '' %}
          {% if 'Fair' in company_name %}
            Fair
          {% elif 'Tabling' in company_name %}
            Tabling
          {% else %}
            Info Session
          {% endif %}
        </div>
        <div class="event-cell company"><strong>{{ event.Company or event.EmployerName or '' }}</strong></div>
        <div class="event-cell">{{ event | format_time_range }}</div>
        <div class="event-cell">{{ event.Location or event.Building ~ ' ' ~ event.Room }}</div>
      </div>
    {% endif %}
  {% endfor %}
</div>

<div class="week-box">
  <h3>Next Week</h3>
  {% for event in events %}
    {% set event_date = event.EventDate | todatetime %}
    {% if event_date >= days[5] and event_date <= days[9] %}
      <div class="event-row">
        <div class="event-cell date">{{ event_date.strftime('%a, %b %d') }}</div>
        <div class="event-cell">
          {% set company_name = event.Company or event.EmployerName or '' %}
          {% if 'Fair' in company_name %}
            Fair
          {% elif 'Tabling' in company_name %}
            Tabling
          {% else %}
            Info Session
          {% endif %}
        </div>
        <div class="event-cell company"><strong>{{ event.Company or event.EmployerName or '' }}</strong></div>
        <div class="event-cell">{{ event | format_time_range }}</div>
        <div class="event-cell">{{ event.Location or event.Building ~ ' ' ~ event.Room }}</div>
      </div>
    {% endif %}
  {% endfor %}
</div>

{% endblock %}
